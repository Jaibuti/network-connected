@[toc]

## 1、信号在网线和集线器中传输

**每个包都是独立传输的**
```
网络包从client中发出后，要经过集线器、交换机、路由器进入互联网；
```
**防止网线中信号衰减**

```
以太网的本质是正负变化的电压；
当网卡中的PHY（MAU）是一个从正负两个信号端子输出信号的电路；

信号在网线中传输，能量会逐渐损失，网线越长，信号衰减越严重；
	- 当点信号的频率越高，能量的损失率越大，拐角变化剧烈；
	- 高频信号更容易损失能量；
```
**双绞是为了抑制噪声**
```
【产生噪声的原因】：
- 网线周围的电磁波，当电磁波接触到金属等导体时，在其中就会产生电流会与信号混杂，导致信号失真；
【双绞线如何抑制电磁波】：
- 当信号线缠绕在一起，将变成螺旋形，其中两根线产生的噪声电流方向就会相反，使得噪声电流相互抵消；
【提升网线性能】：
- 在信号线之间加入隔板保持距离；
- 外面包裹可阻挡电磁波的金属屏蔽网；
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/b17fe8385b4b4bdc9d96eef4d8ffb3a6.png)
**集线器将信号发往所有线路**
```
当包到集线器后，会被广播到整个网络，根据包中接收方MAC地址来判断是否应该接收；

【交叉网线】：能将两台计算机连接起来；
网卡可以连接集线器，由于内部的PHY模块和集线器一样，故两台计算机的网卡可互相连接；
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/14d46cb12c7c44888f0e53e32bb7fd74.png)

## 2、交换机的包转发操作
**交换机根据地址表进行转发**
```
交换机是将网络包原样转发到目的地，采用交换电路、高速总线、共享内存等方式；
交换机内部有一张MAC地址与网线端口的对应表，当接收到包时，会将相应的端口和发送方MAC地址写入表中，即可根据地址判断
	改设备连接在哪个端口上；

当信号到达网线接口，并由PHY模块接收，该模块将网线中的信号转换为通用格式，传递给MAC模式，MAC模块将信号转换为数字
信息，在通过包末尾的FCS校验错误，若无误则放置在缓冲区；交换机不具有MAC地址，不会进行MAC地址核对，直接接收所有包
并放到缓冲区中；
而后，查询该包接收方的MAC地址是否在MAC地址表中有记录（有设备的MAC地址和设备在叫环节的哪个端口）进行转发；
```
**交换机工作**
[参考2、以太网交换机](https://blog.csdn.net/weixin_45926547/article/details/124767845?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165352139616782248569244%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=165352139616782248569244&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-3-124767845-null-null.nonecase&utm_term=%E4%BA%A4%E6%8D%A2%E6%9C%BA&spm=1018.2226.3001.4450)
```
它可将其输入输出端连接，每个交叉点都是一个交换开关，通过切换开关的状态改变信号的流向；
当网络包通过交换电路到达发送端口，线确认是否有其他设备在发送信号，若有，则需等待其他包发送完毕再发送；
```

**MAC地址表的维护**
```
【收到包时】：将发送方MAC地址以及输入端口号写入MAC地址，每次收到包都会执行该操作；
【删除地址表中某条记录的操作】：防止设备移动时产生问题，记录具有一定的生命周期；
当交换机重启，地址表会被清空；
```
**特殊操作**

```
【若发送地址表中目标端口和源端口为同一个，（当集线器和交换机一起使用时）会怎么处理？】
计算机A发送的包到达集线器后被转发到所有端口上，将会到达交换机和计算机B，交换机会转发这个包，即再次到达集线器，又向
所有端口进行转发，B收到两个相同的包，导致无法正常通信，故交换机发现包要发往源端口，直接将其丢弃；

【MAC表中找不到指定的MAC地址】
只能将包转发到除了源端口之外的所有端口上；
```
**自动协商：确定最优的传输速率**
```
能够在连接时双方探测对方是否支持全双工模式，并自动切换工作模式，探测对方的传输速率并进行自动切换；
当没有数据在传输时，网络中填充一种连接脉冲的脉冲信号，检测对方是否在正常工作；
【没有数据传输时】：
奇数位置的脉冲信号时用于同步的，它以固定间隔发送，没有特别的含义；
偶数位置的脉冲信号有时发送有时不发送，其排列是有特别含义的，阔以告知对方自己的工作模式等状态信息；

当硬件初始化后，就开始用脉冲信号发送自己支持的速率和工作模式，当对方收到信号后，通过读取脉冲信号排序来判断对方支持的模式；
```
**交换机可同时执行多个转发操作**

```
交换机只将包转发到具体特定MAC地址的设备连接的端口，其他端口都是空闲的；
空闲的端口可传输其他的包，因此交换机阔以同时转发多个包；
```

## 3、路由器的包转发操作
**路由器基本概念**
```
与交换机不同，交换机是基于以太网设计的，而路由器是基于IP设计的；
当网络包经交换机到达路由器，则包会被转发到下一个路由器；

路由器包括转发模块和端口模块；
- 转发模块：负责判断包的转发目的地，根据IP头部记录的接收方IP地址，再路由表中查询；
	转发模块会将包转移到转发目标对应的端口，端口再根据硬件规则发送出去；
- 端口模块：负责包的收发操作，可安装支持其他技术的硬件以支持其他通信技术；
	端口具有MAC地址，可称为以太网的接收方和发送方；
两个模块的关系相当于协议栈的IP模块和网卡；
```

**路由表的信息**
![在这里插入图片描述](https://img-blog.csdnimg.cn/e90ce786d577446aab63806345bf9c05.png)

```
交换机是通过MAC头部中的接收方MAC地址来判断转发目标，而路由器是根据IP头部中的IP地址来判断；
【匹配地址】：
路由器需要知道网络号的比特数，通过子网掩码判断网络号的比特数；
	路由器会忽略主机号，只匹配网络号；
【当地址本身的子网掩码和表中的子网掩码不一致时】
- 这是路由聚合的结果，会将几个子网合并成一个子网，并再表中只产生一条记录；

【路由聚合】：无论发往任何一个子网，都是通过路由器A进行转发，在该路由表中将多个子网合并成一个子网；
```
[参考【计算机网络】| 【04】网络层](https://blog.csdn.net/weixin_45926547/article/details/124824013?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165353534716781667873539%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=165353534716781667873539&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124824013-null-null.nonecase&utm_term=%E8%B7%AF%E7%94%B1%E8%A1%A8&spm=1018.2226.3001.4450)